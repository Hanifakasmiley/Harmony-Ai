<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feature 5 â€“ AI Analysis & Risk Assessment</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="assets/css/style.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="admin-container">
    <aside class="sidebar">
      <h2>ğŸ§  Hermony AI</h2>
      <ul>
        <li><a href="index.html">ğŸ  Dashboard</a></li>
        <li><a href="feature1.html">ğŸ“‹ Mood Logging</a></li>
        <li><a href="feature2.html">ğŸ‘¨â€âš•ï¸ Counsellors</a></li>
        <li><a href="feature3.html">ğŸ§˜ Recommendations</a></li>
        <li><a href="feature4.html">â­ Feedback</a></li>
        <li><a href="feature5.html" class="active">ğŸ¤– AI Analysis</a></li>
        <li><a href="feature6.html">ğŸ‘¤ Profiles</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <h2>AI Analysis & Risk Assessment</h2>
      <p>Advanced AI-powered analysis with risk scoring, sentiment analysis, and emotion classification for personalized
        mental health monitoring.</p>

      <!-- AI ANALYSIS FORM SECTION -->
      <section
        style="margin-top: 3rem; background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
        <h3>Generate AI Analysis</h3>
        <form id="aiAnalysisForm">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">User ID</label>
              <input type="number" class="form-control" id="aiUserId" placeholder="Enter user ID" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Analysis Date</label>
              <input type="date" class="form-control" id="aiDate" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Data Source</label>
              <select class="form-control" id="aiDataSource" required>
                <option value="">-- Select Source --</option>
                <option value="Mood Logs">ğŸ“‹ Mood Logs</option>
                <option value="User Messages">ğŸ’¬ User Messages</option>
                <option value="Session Notes">ğŸ“ Session Notes</option>
                <option value="Activity Data">ğŸ“Š Activity Data</option>
                <option value="Sleep Data">ğŸ˜´ Sleep Data</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">Risk Score (0-100)</label>
              <div class="input-group">
                <input type="range" class="form-range" id="riskScore" min="0" max="100" value="50" required>
                <input type="number" class="form-control" id="riskScoreDisplay" min="0" max="100" value="50"
                  style="max-width: 80px;">
              </div>
              <small class="d-block mt-1 text-muted">Current Risk: <span id="riskValue">50</span>/100</small>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Risk Level</label>
              <div id="riskLevelDisplay"
                style="padding: 10px; border-radius: 8px; background: #fff3cd; text-align: center; font-weight: 600;">
                <span id="riskLevelText">Medium ğŸŸ¡</span>
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Sentiment Score (-1 to +1)</label>
              <input type="range" class="form-range" id="sentimentScore" min="-1" max="1" step="0.1" value="0" required>
              <small class="d-block mt-2 text-muted">Value: <span id="sentimentValue">0.0</span></small>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Primary Emotion Classification</label>
              <select class="form-control" id="aiEmotion1" required>
                <option value="">-- Select Primary Emotion --</option>
                <option value="Joy">ğŸ˜Š Joy</option>
                <option value="Sadness">ğŸ˜¢ Sadness</option>
                <option value="Anxiety">ğŸ˜° Anxiety</option>
                <option value="Anger">ğŸ˜  Anger</option>
                <option value="Fear">ğŸ˜¨ Fear</option>
                <option value="Neutral">ğŸ˜ Neutral</option>
                <option value="Disgust">ğŸ¤¢ Disgust</option>
                <option value="Surprise">ğŸ˜² Surprise</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Secondary Emotion Classification</label>
              <select class="form-control" id="aiEmotion2">
                <option value="">-- Select Secondary Emotion (Optional) --</option>
                <option value="Joy">ğŸ˜Š Joy</option>
                <option value="Sadness">ğŸ˜¢ Sadness</option>
                <option value="Anxiety">ğŸ˜° Anxiety</option>
                <option value="Anger">ğŸ˜  Anger</option>
                <option value="Fear">ğŸ˜¨ Fear</option>
                <option value="Neutral">ğŸ˜ Neutral</option>
                <option value="Disgust">ğŸ¤¢ Disgust</option>
                <option value="Surprise">ğŸ˜² Surprise</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Analysis Summary & Insights</label>
            <textarea class="form-control" id="aiSummary" rows="4"
              placeholder="AI-generated summary of analysis, key findings, and behavioral patterns..."
              required></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Recommended Actions</label>
            <textarea class="form-control" id="aiRecommendations" rows="3"
              placeholder="AI-recommended interventions and next steps for the user..."></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Confidence Score (%)</label>
            <input type="number" class="form-control" id="aiConfidence" min="0" max="100"
              placeholder="AI model confidence in analysis (0-100)" required>
          </div>

          <button type="submit" class="btn btn-primary">ğŸ¤– Generate Analysis</button>
          <button type="reset" class="btn btn-secondary">Clear Form</button>
        </form>
      </section>

      <!-- AI ANALYTICS SECTION -->
      <section style="margin-top: 3rem;">
        <h3>AI Analysis Dashboard</h3>
        <div class="row">
          <div class="col-md-6">
            <div
              style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
              <h5>Risk Score Distribution</h5>
              <canvas id="riskChart" height="80"></canvas>
            </div>
          </div>
          <div class="col-md-6">
            <div
              style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
              <h5>AI Analysis Statistics</h5>
              <div class="ai-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Analyses</span>
                  <span class="stat-value" id="totalAnalyses">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">High Risk Users</span>
                  <span class="stat-value" id="highRiskCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Avg Sentiment</span>
                  <span class="stat-value" id="avgSentiment">0.0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Avg Confidence</span>
                  <span class="stat-value" id="avgConfidence">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SENTIMENT & EMOTION ANALYSIS -->
      <section style="margin-top: 3rem;">
        <div class="row">
          <div class="col-md-6">
            <div
              style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
              <h5>Emotion Frequency</h5>
              <canvas id="emotionChart" height="80"></canvas>
            </div>
          </div>
          <div class="col-md-6">
            <div
              style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
              <h5>Sentiment Trend</h5>
              <canvas id="sentimentChart" height="80"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- AI ANALYSIS TABLE SECTION -->
      <section style="margin-top: 3rem;">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>All AI Analyses</h3>
          <input type="text" id="searchAIAnalysis" class="form-control w-50"
            placeholder="ğŸ” Search by user ID or emotion">
        </div>

        <div class="table-responsive">
          <table class="table table-hover" id="aiAnalysisTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>User ID</th>
                <th>Date</th>
                <th>Risk Score</th>
                <th>Risk Level</th>
                <th>Primary Emotion</th>
                <th>Sentiment</th>
                <th>Confidence</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- View AI Analysis Modal -->
      <div class="modal fade" id="viewAIAnalysisModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">AI Analysis Details</h5>
              <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="aiAnalysisDetailsContent">
              <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    // ===== RISK SCORE SYNC =====
    document.getElementById('riskScore').addEventListener('input', (e) => {
      const value = e.target.value;
      document.getElementById('riskScoreDisplay').value = value;
      document.getElementById('riskValue').textContent = value;
      updateRiskLevelDisplay(value);
    });

    document.getElementById('riskScoreDisplay').addEventListener('input', (e) => {
      const value = Math.max(0, Math.min(100, e.target.value));
      document.getElementById('riskScore').value = value;
      document.getElementById('riskValue').textContent = value;
      updateRiskLevelDisplay(value);
    });

    // ===== SENTIMENT SCORE SYNC =====
    document.getElementById('sentimentScore').addEventListener('input', (e) => {
      const value = parseFloat(e.target.value).toFixed(1);
      document.getElementById('sentimentValue').textContent = value;
    });

    // ===== UPDATE RISK LEVEL DISPLAY =====
    function updateRiskLevelDisplay(score) {
      const scoreNum = parseInt(score);
      let levelText = '';
      let bgColor = '';

      if (scoreNum <= 30) {
        levelText = 'Low Risk ğŸŸ¢';
        bgColor = '#d4edda';
      } else if (scoreNum <= 60) {
        levelText = 'Medium Risk ğŸŸ¡';
        bgColor = '#fff3cd';
      } else {
        levelText = 'High Risk ğŸ”´';
        bgColor = '#f8d7da';
      }

      const display = document.getElementById('riskLevelDisplay');
      display.style.background = bgColor;
      document.getElementById('riskLevelText').textContent = levelText;
    }

    // ===== POPULATE AI ANALYSIS TABLE =====
    async function populateAIAnalysisTable() {
      try {
        const analyses = await window.DailyDB.getAllAIAnalysis();
        const tbody = document.querySelector('#aiAnalysisTable tbody');
        tbody.innerHTML = '';

        if (analyses.length === 0) {
          tbody.innerHTML = '<tr><td colspan="9" class="text-center text-muted">No AI analyses yet</td></tr>';
          return;
        }

        // Sort by date descending
        analyses.sort((a, b) => new Date(b.date) - new Date(a.date));

        analyses.forEach(analysis => {
          const row = document.createElement('tr');

          let riskBadgeColor = 'bg-success';
          let riskText = 'Low';
          if (analysis.riskScore > 60) {
            riskBadgeColor = 'bg-danger';
            riskText = 'High';
          } else if (analysis.riskScore > 30) {
            riskBadgeColor = 'bg-warning';
            riskText = 'Medium';
          }

          const sentimentEmoji = analysis.sentimentScore > 0 ? 'ğŸ˜Š' : (analysis.sentimentScore < 0 ? 'ğŸ˜¢' : 'ğŸ˜');

          row.innerHTML = `
            <td><strong>${analysis.id}</strong></td>
            <td><strong>U${analysis.userId}</strong></td>
            <td>${analysis.date}</td>
            <td><span class="badge bg-info">${analysis.riskScore}/100</span></td>
            <td><span class="badge ${riskBadgeColor}">${riskText}</span></td>
            <td>${getEmotionEmoji(analysis.emotion1)} ${analysis.emotion1}</td>
            <td>${sentimentEmoji} ${analysis.sentimentScore.toFixed(2)}</td>
            <td>${analysis.confidence}%</td>
            <td>
              <button class="btn btn-sm btn-info viewAIBtn" data-id="${analysis.id}">ğŸ‘ï¸ View</button>
              <button class="btn btn-sm btn-danger deleteAIBtn" data-id="${analysis.id}">ğŸ—‘ï¸ Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });

        // Update analytics
        updateAIStats(analyses);
        initializeRiskChart(analyses);
        initializeEmotionChart(analyses);
        initializeSentimentChart(analyses);
      } catch (err) {
        console.error('Error loading AI analyses:', err);
      }
    }

    // ===== GET EMOTION EMOJI =====
    function getEmotionEmoji(emotion) {
      const emojis = {
        'Joy': 'ğŸ˜Š',
        'Sadness': 'ğŸ˜¢',
        'Anxiety': 'ğŸ˜°',
        'Anger': 'ğŸ˜ ',
        'Fear': 'ğŸ˜¨',
        'Neutral': 'ğŸ˜',
        'Disgust': 'ğŸ¤¢',
        'Surprise': 'ğŸ˜²'
      };
      return emojis[emotion] || 'ğŸ˜';
    }

    // ===== SUBMIT AI ANALYSIS FORM =====
    document.getElementById('aiAnalysisForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const analysis = {
        userId: parseInt(document.getElementById('aiUserId').value),
        date: document.getElementById('aiDate').value,
        dataSource: document.getElementById('aiDataSource').value,
        riskScore: parseInt(document.getElementById('riskScore').value),
        sentimentScore: parseFloat(document.getElementById('sentimentScore').value),
        emotion1: document.getElementById('aiEmotion1').value,
        emotion2: document.getElementById('aiEmotion2').value || null,
        summary: document.getElementById('aiSummary').value,
        recommendations: document.getElementById('aiRecommendations').value,
        confidence: parseInt(document.getElementById('aiConfidence').value),
        timestamp: new Date().toISOString()
      };

      try {
        await window.DailyDB.addAIAnalysis(analysis);
        alert('âœ… AI Analysis generated successfully!');
        document.getElementById('aiAnalysisForm').reset();
        document.getElementById('riskScore').value = 50;
        document.getElementById('riskScoreDisplay').value = 50;
        document.getElementById('riskValue').textContent = 50;
        document.getElementById('sentimentScore').value = 0;
        document.getElementById('sentimentValue').textContent = '0.0';
        updateRiskLevelDisplay(50);
        await populateAIAnalysisTable();
      } catch (err) {
        alert('âŒ Error generating analysis: ' + err.message);
      }
    });

    // ===== VIEW AI ANALYSIS =====
    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('viewAIBtn')) {
        const analysisId = e.target.getAttribute('data-id');
        const analyses = await window.DailyDB.getAllAIAnalysis();
        const analysis = analyses.find(a => a.id === parseInt(analysisId));

        if (analysis) {
          let riskLevel = 'Low Risk ğŸŸ¢';
          if (analysis.riskScore > 60) riskLevel = 'High Risk ğŸ”´';
          else if (analysis.riskScore > 30) riskLevel = 'Medium Risk ğŸŸ¡';

          const sentimentLabel = analysis.sentimentScore > 0 ? 'Positive' : (analysis.sentimentScore < 0 ? 'Negative' : 'Neutral');

          const content = `
            <p><strong>Analysis ID:</strong> ${analysis.id}</p>
            <p><strong>User ID:</strong> U${analysis.userId}</p>
            <p><strong>Date:</strong> ${analysis.date}</p>
            <p><strong>Data Source:</strong> ${analysis.dataSource}</p>
            
            <div style="border-top: 2px solid #e2e8f0; margin: 1rem 0; padding-top: 1rem;">
              <h6>Risk Assessment</h6>
              <p><strong>Risk Score:</strong> <span class="badge bg-info">${analysis.riskScore}/100</span></p>
              <p><strong>Risk Level:</strong> ${riskLevel}</p>
              <div class="progress">
                <div class="progress-bar ${analysis.riskScore > 60 ? 'bg-danger' : (analysis.riskScore > 30 ? 'bg-warning' : 'bg-success')}" style="width: ${analysis.riskScore}%"></div>
              </div>
            </div>

            <div style="border-top: 2px solid #e2e8f0; margin: 1rem 0; padding-top: 1rem;">
              <h6>Emotion & Sentiment Analysis</h6>
              <p><strong>Primary Emotion:</strong> ${getEmotionEmoji(analysis.emotion1)} ${analysis.emotion1}</p>
              ${analysis.emotion2 ? `<p><strong>Secondary Emotion:</strong> ${getEmotionEmoji(analysis.emotion2)} ${analysis.emotion2}</p>` : ''}
              <p><strong>Sentiment Score:</strong> <span class="badge bg-info">${analysis.sentimentScore.toFixed(2)}</span></p>
              <p><strong>Sentiment:</strong> ${sentimentLabel}</p>
            </div>

            <div style="border-top: 2px solid #e2e8f0; margin: 1rem 0; padding-top: 1rem;">
              <h6>Analysis Summary</h6>
              <div class="alert alert-info">${analysis.summary}</div>
            </div>

            ${analysis.recommendations ? `
              <div style="border-top: 2px solid #e2e8f0; margin: 1rem 0; padding-top: 1rem;">
                <h6>Recommended Actions</h6>
                <div class="alert alert-success">${analysis.recommendations}</div>
              </div>
            ` : ''}

            <div style="border-top: 2px solid #e2e8f0; margin: 1rem 0; padding-top: 1rem;">
              <p><strong>Model Confidence:</strong> <span class="badge bg-secondary">${analysis.confidence}%</span></p>
              <p><strong>Generated:</strong> ${new Date(analysis.timestamp).toLocaleString()}</p>
            </div>
          `;
          document.getElementById('aiAnalysisDetailsContent').innerHTML = content;
          const modal = new bootstrap.Modal(document.getElementById('viewAIAnalysisModal'));
          modal.show();
        }
      }
    });

    // ===== DELETE AI ANALYSIS =====
    document.addEventListener('click', async (e) => {
      if (e.target.classList.contains('deleteAIBtn')) {
        const analysisId = e.target.getAttribute('data-id');
        if (confirm('Are you sure you want to delete this AI analysis?')) {
          try {
            await window.DailyDB.deleteAIAnalysis(analysisId);
            alert('âœ… Analysis deleted successfully!');
            await populateAIAnalysisTable();
          } catch (err) {
            alert('âŒ Error deleting analysis: ' + err.message);
          }
        }
      }
    });

    // ===== SEARCH AI ANALYSIS =====
    document.getElementById('searchAIAnalysis').addEventListener('keyup', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      document.querySelectorAll('#aiAnalysisTable tbody tr').forEach(row => {
        const rowText = row.innerText.toLowerCase();
        row.style.display = rowText.includes(searchTerm) ? '' : 'none';
      });
    });

    // ===== UPDATE AI STATISTICS =====
    function updateAIStats(analyses) {
      document.getElementById('totalAnalyses').textContent = analyses.length;

      const highRiskCount = analyses.filter(a => a.riskScore > 60).length;
      document.getElementById('highRiskCount').textContent = highRiskCount;

      const avgSentiment = (analyses.reduce((sum, a) => sum + a.sentimentScore, 0) / analyses.length).toFixed(2);
      document.getElementById('avgSentiment').textContent = avgSentiment;

      const avgConfidence = Math.round(analyses.reduce((sum, a) => sum + a.confidence, 0) / analyses.length);
      document.getElementById('avgConfidence').textContent = avgConfidence + '%';
    }

    // ===== RISK CHART INITIALIZATION =====
    let riskChartInstance = null;

    function initializeRiskChart(analyses) {
      const riskLevels = { 'Low': 0, 'Medium': 0, 'High': 0 };
      analyses.forEach(a => {
        if (a.riskScore <= 30) riskLevels['Low']++;
        else if (a.riskScore <= 60) riskLevels['Medium']++;
        else riskLevels['High']++;
      });

      const ctx = document.getElementById('riskChart').getContext('2d');
      if (riskChartInstance) riskChartInstance.destroy();

      riskChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Low Risk', 'Medium Risk', 'High Risk'],
          datasets: [{
            label: 'Risk Distribution',
            data: [riskLevels['Low'], riskLevels['Medium'], riskLevels['High']],
            backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: Math.max(5, riskLevels['Low'], riskLevels['Medium'], riskLevels['High']) + 1
            }
          }
        }
      });
    }

    // ===== EMOTION CHART INITIALIZATION =====
    let emotionChartInstance = null;

    function initializeEmotionChart(analyses) {
      const emotionCount = {};
      analyses.forEach(a => {
        emotionCount[a.emotion1] = (emotionCount[a.emotion1] || 0) + 1;
      });

      const emotions = Object.keys(emotionCount);
      const counts = Object.values(emotionCount);
      const colors = ['#FFB6C1', '#87CEEB', '#FFD700', '#FF6347', '#9370DB', '#90EE90', '#FF8C00', '#20B2AA'];

      const ctx = document.getElementById('emotionChart').getContext('2d');
      if (emotionChartInstance) emotionChartInstance.destroy();

      emotionChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: emotions,
          datasets: [{
            data: counts,
            backgroundColor: colors.slice(0, emotions.length),
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // ===== SENTIMENT TREND CHART =====
    let sentimentChartInstance = null;

    function initializeSentimentChart(analyses) {
      const sorted = [...analyses].sort((a, b) => new Date(a.date) - new Date(b.date));
      const dates = sorted.map(a => a.date);
      const sentiments = sorted.map(a => a.sentimentScore);

      const ctx = document.getElementById('sentimentChart').getContext('2d');
      if (sentimentChartInstance) sentimentChartInstance.destroy();

      sentimentChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Sentiment Trend',
            data: sentiments,
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            tension: 0.4,
            fill: true,
            pointBackgroundColor: sentiments.map(s => s > 0 ? '#28a745' : (s < 0 ? '#dc3545' : '#ffc107'))
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true }
          },
          scales: {
            y: {
              beginAtZero: true,
              min: -1,
              max: 1,
              ticks: {
                callback: function (value) {
                  return value.toFixed(1);
                }
              }
            }
          }
        }
      });
    }

    // ===== INITIALIZE =====
    document.addEventListener('DOMContentLoaded', async () => {
      await populateAIAnalysisTable();
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('aiDate').value = today;
    });
  </script>
</body>

</html>